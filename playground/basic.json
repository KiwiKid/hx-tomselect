{"name":"Welcome!","method":"url","files":[{"location":"./playgrounds/welcome/server.js","filename":"server.js","builtin":true,"contents":"\nlet genres = [\n    \"Rock\",\n    \"Electronic\",\n    \"Country\",\n    \"Heavy metal\",\n    \"Hip hop\",\n    \"Jazz\",\n    \"Classical\",\n    \"Soul\",\n    \"Folk\",\n    \"Reggae\",\n    \"Techno\",\n    \"Disco\"\n]\n\non.get(\"/\", (request) => {\n\n    let context = {\n        text: \"Click for a random music genre\"\n    }\n\n    return render(request, 'index.html', context)\n})\n\non.post(\"/random-genre\", (request) => {\n    \n    let genre = genres[Math.floor(Math.random() * genres.length)]\n\n    let context = {\n        text: genre\n    }\n\n    return render(request, 'button.html', context)\n})\n"},{"location":"./playgrounds/welcome/.playground.json","filename":".playground.json","builtin":true,"contents":"{\n    \"name\": \"Welcome!\",\n    \"method\": \"url\",\n    \"files\": [\n        {\n            \"location\": \"./playgrounds/welcome/server.js\",\n            \"filename\": \"server.js\",\n            \"builtin\": true\n        },\n        {\n            \"location\": \"./playgrounds/welcome/.playground.json\",\n            \"filename\": \".playground.json\",\n            \"builtin\": true\n        },\n        {\n            \"location\": \"./playgrounds/.loader.html\",\n            \"filename\": \".loader.html\",\n            \"builtin\": true\n        },\n        {\n            \"location\": \"./playgrounds/welcome/index.html\",\n            \"filename\": \"index.html\"\n        },\n        {\n            \"location\": \"./playgrounds/welcome/button.html\",\n            \"filename\": \"button.html\"\n        }\n    ]\n}"},{"location":"./playgrounds/.loader.html","filename":".loader.html","builtin":true,"contents":"<script src=\"./js/nunjucks.js\"></script>\n<script src=\"./js/pollyjs-core.js\"></script>\n<script src=\"./js/pollyjs-adapter-fetch.js\"></script>\n<script src=\"./js/pollyjs-adapter-xhr.js\"></script>\n<script>\n\n    document.addEventListener('htmx:configRequest', function(evt) {\n        evt.detail.path = window.location.href + evt.detail.path;\n    });\n\n    const fileContents = {};\n    files.forEach(file => fileContents[file.filename] = file.contents);\n\n    function readFile(filename) {\n        return fileContents[filename]\n    }\n\n    let TemplateLoader = {\n        getSource: (name) => ({\n            src: readFile(name),\n            path: name\n        })\n    }\n    var templates = new nunjucks.Environment(TemplateLoader, {\n        autoescape: false\n    })\n\n    function render(request, template, context) {\n        let out = templates.render(template, {...context, request});\n        \n        return new Response(out, {\n            headers: {\n                'content-type': 'text/html'\n            }\n        })\n    }\n\n    const { Polly } = window['@pollyjs/core'];\n\n    Polly.register(window['@pollyjs/adapter-fetch']);\n    Polly.register(window['@pollyjs/adapter-xhr']);\n\n    const polly = new Polly('sandbox-server', {\n        adapters: ['fetch', 'xhr'],\n        mode: \"passthrough\",\n        logging: true,\n    });\n\n    const server = polly.server;\n    \n    const on = {};\n    \n    ['get','put','post','patch','delete','merge','head','options'].forEach((method) => {\n        on[method] = (route, handler) => {\n            \n            let parsedRoute = window.location.href + route.replaceAll(/\\/<([^>]+)>/gm, (_, m) => \"/:\"+m)\n\n            server[method](parsedRoute).intercept(async (req, res) => {\n\n                var requestHeaders = Object.assign({}, req.headers)\n                var request = new Request(req.url, {\n                    body: req.body,\n                    headers: requestHeaders,\n                    method: req.method,\n                })\n\n                var response = await handler(request, ...Object.values(req.params), ...new URL(req.url).searchParams.values())\n\n                if (!response) throw new Error(\"Handler returned no response!\") // Return 404?\n\n                let responseHeaders = {}\n\n                for (const [k,v] of response.headers.entries()) {\n                    res.setHeader(k,v);\n                    responseHeaders[k] = v\n                }\n\n                let text = await response.text()\n\n                \n                res.status(response.status).send(text);\n                \n                window.parent.postMessage({\n                    type: \"network_log\",\n                    request: {\n                        url: req.url.replace(window.location.href, ''),\n                        body: req.body,\n                        method: req.method,\n                        headers: requestHeaders,\n                    },\n                    response: {\n                        headers: responseHeaders,\n                        status: response.status,\n                        body: text,\n                    },\n                }, \"*\")\n            });\n        }\n    })\n    \n    const sleep = (delay) => new Promise((resolve) => setTimeout(resolve, delay))\n</script>\n<script type=\"module\">\n    ///server.js\n</script>"},{"location":"./playgrounds/welcome/index.html","filename":"index.html","contents":"<html>\n<head>\n    <script src=\"https://unpkg.com/htmx.org@latest\"></script>\n    <link href=\"https://unpkg.com/tom-select@latest/dist/css/tom-select.css\" rel=\"stylesheet\" />\n    <script src=\"https://unpkg.com/tom-select@latest/dist/js/tom-select.complete.min.js\" ></script>\n    <script src=\"https://unpkg.com/hx-tomselect/hx-tomselect.js\" ></script>\n</head>\n<body>\n        <select hx-ext=\"tomselect\">\n            <option value=\"\">Select an option</option>\n            <option value=\"1\">Option 1</option>\n            <option value=\"2\">Option 2</option>\n            <option value=\"3\">Option 3</option>\n        </select>\n    </body>\n</html>"},{"location":"./playgrounds/welcome/button.html","filename":"button.html","contents":"<button hx-post=\"/random-genre\" hx-swap=\"outerHTML\">\n    <b>\n        {{ text }}\n    </b>\n</button>"}]}